{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" href="{% static 'flashdeck/images/Logo.png' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'flashdeck/css/styles.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap"
        rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Decks | FlashDeck</title>
    <style>
      .card{
        background-color: #A4E3FF !important;
        border: 6px solid black !important;
        border-radius: 12px !important;
        width: 325px !important;
        height: 400px !important;
        max-height: 400px !important;
        max-width: 325px !important;
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
        cursor: pointer;
      }
  
      .card.active {
          display: block;
      }
  
      .prototype-box {
          position: absolute;
          width: 300px;
          height: 500px;
          border-radius: 10px;
          box-shadow: 0 4px 8px rgba(0,0,0,0.3);
          background: #303030 !important;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.3s ease-in-out;
          opacity: 1;
          border: 2px solid #A4E3FF;
      }

  
      .prototype-box.front {
          transform: scale(1);
      }
  
      .prototype-box.back {
          opacity: 0;
          transform: scale(0.95);
      }
  
      .card.flipped .front {
          opacity: 0;
          transform: scale(0.95);
      }
  
      .card.flipped .back {
          opacity: 1;
          transform: scale(1);
      }
  
      .card-text {
          padding: 20px;
          position: relative;
          max-height: 100%;
          margin: 0;
          word-wrap: break-word;
          color: white;
      }
  
      .text-container {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 20px;
      }

      #footer {
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          background-color: black;
          padding-top: 20px;
          z-index: 1000;
      }

      .main-content {
          margin-bottom: 50px; /* Adjust this value based on your footer height */
          min-height: calc(100vh - 250px); /* This ensures minimum height of content area */
          padding-top: 10px;
      }

      /* Different text sizes for question and answer */
      .front .card-text {
          font-size: 24px;  /* Larger text for questions */
      }

      .back .card-text {
          font-size: 18px;  /* Smaller text for answers */
      }

      body {
          overflow: hidden;
          position: fixed;
          width: 100%;
          height: 100%;
      }

      .main-content {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          display: flex;
          flex-direction: column;
          padding-top: 10px; /* Significantly reduced from 60px */
      }

      .confidence-buttons {
          position: relative;
          width: 100%;
          display: flex;
          justify-content: center;
          padding: 0; /* Removed padding completely */
          margin-top: 5px; /* Add margin to position below navbar */
          z-index: 10;
      }

      .card-container {
          flex: 1;
          display: flex;
          justify-content: center;
          align-items: center;
          margin-top: 300px; /* Adjusted to center the taller card */
      }

      #footer {
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          z-index: 1000;
      }
  </style>
</head>

<body>
    <!-- NAVBAR -->
    <nav class="navbar fixed-top navbar-dark bg-black navbar-expand-lg rounded-bottom-2">
        <div class="container-fluid">
            <a href="/" class="navbar-brand">
                <img src="{% static 'flashdeck/images/Logo.png' %}" class="img-fluid" alt="." width="60" height="60">
                <p class="d-inline" id="flashdeckTitleNav">FLASHDECK</p>
            </a>
            <button class="navbar-toggler border" id="navbarToggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a href="{% url 'cardset_list' %}" class="nav-link active">My Decks</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'account' %}">Account</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- END NAVBAR -->

  <!-- Main Content -->
  <div class="container d-flex flex-column align-items-center main-content">
    <!-- Confidence Buttons at top -->
    <div class="confidence-buttons">
        <div class="confidence-level text-center mx-2">
            <div class="confidence-container">
                <button class="confidence-button" onclick="incrementCount(this, 'Confident')">0</button>
                <div onclick="incrementCount(this.previousElementSibling, 'Confident')">Confident</div>
            </div>
        </div>
        <div class="confidence-level text-center mx-2">
            <div class="confidence-container">
                <button class="confidence-button" onclick="incrementCount(this, 'Good')">0</button>
                <div onclick="incrementCount(this.previousElementSibling, 'Good')">Good</div>
            </div>
        </div>
        <div class="confidence-level text-center mx-2">
            <div class="confidence-container">
                <button class="confidence-button" onclick="incrementCount(this, 'Needs Work')">0</button>
                <div onclick="incrementCount(this.previousElementSibling, 'Needs Work')">Needs Work</div>
            </div>
        </div>
        <div class="confidence-level text-center mx-2">
            <div class="confidence-container">
                <button class="confidence-button" onclick="incrementCount(this, 'Again')">0</button>
                <div onclick="incrementCount(this.previousElementSibling, 'Again')">Again</div>
            </div>
        </div>
    </div>
    
    <p class="mt-3" style="color: #ffffff">Number of reviews this session: <span id="flipCounter">0</span></p>

    <!-- Card Container -->
    <div class="card-container">
        {% if cards %}
            {% for card in cards %}
                <div class="card" id="card-{{ forloop.counter }}" data-card-id="{{ card.id }}">
                    <!-- Front of the card -->
                    <div class="prototype-box front">
                        <div class="text-container">
                            <p class="card-text">{{ card.question }}</p>
                        </div>
                    </div>
                    <!-- Back of the card -->
                    <div class="prototype-box back">
                        <div class="text-container">
                            <p class="card-text">{{ card.answer }}</p>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="text-white">No cards found in this deck.</p>
        {% endif %}
    </div>
  </div>
  <!-- End Main Content -->

  <!-- Footer -->
  <div class="container-fluid mt-5" id="footer">
    <div class="row">
      <div class="col text-center text-white">
        <p id="footerHeader">FLASHDECK</p>
      </div>
    </div>
    <div class="row">
      <div class="col text-center text-white">
        <div id="footerLoremIpsum">
          <p>Lorem Ipsum dolor sit amet consectetur adipisicing elit. Ratione veniam</p>
          <p>amet autem sunt. perspiciatis nemo.</p>
        </div>
      </div>
    </div>
    <div class="row mb-1">
      <div class="col d-flex justify-content-center" id="footerLogos">
        <a href="https://www.facebook.com/"><img class="img-fluid mx-1"
            src="{% static 'flashdeck/images/facebook-icon.png' %}" style="width: 25px; height: 25px"
            alt="Facebook"></a>
        <a href="https://www.instagram.com"><img class="img-fluid mx-1"
            src="{% static 'flashdeck/images/instagram-icon.png' %}" style="width: 25px; height: 25px"
            alt="Instagram"></a>
        <a href="https://twitter.com/"><img class="img-fluid mx-1" src="{% static 'flashdeck/images/x-icon.png' %}"
            style="width: 25px; height: 25px" alt="X"></a>
      </div>
    </div>
    <div class="row">
      <div class="col d-flex text-white justify-content-center">
        <p id="footerLegal">Â© 2024 FlashDeck | All Rights Reserved</p>
      </div>
    </div>
  </div>
  <!-- End Footer -->

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      let cardsData = [];
      let currentIndex = 0;
      let flipCount = 0;
      let cards = Array.from(document.querySelectorAll('.card'));
      
      // Show first card
      if (cards.length > 0) {
          cards[0].classList.add('active');
      }

      function spacebarHandler(event) {
          if (event.code === 'Space') {
              event.preventDefault();
              const currentCard = cards[currentIndex];
              if (currentCard) {
                  currentCard.classList.toggle('flipped');
              }
          }
      }

      // Prevent scrolling
      window.addEventListener('keydown', function(e) {
          if(['Space', 'ArrowUp', 'ArrowDown'].indexOf(e.code) > -1) {
              e.preventDefault();
          }
      });

      document.addEventListener('keydown', spacebarHandler);

      // Make incrementCount available globally
      window.incrementCount = function(button, confidenceLevel) {
          console.log('Confidence button clicked:', confidenceLevel);
          const currentCard = cards[currentIndex];
          
          // Verify card is flipped
          if (!currentCard.classList.contains('flipped')) {
              alert('Please flip the card before rating your confidence!');
              return;
          }

          // Store important elements
          const cardContainer = document.querySelector('.card-container');
          const confidenceButtons = document.querySelector('.confidence-buttons');
          const debugInfo = document.querySelector('.debug-info');
          const reviewCount = document.querySelector('#flipCounter').parentElement;
          const flipCounterSpan = document.querySelector('#flipCounter');
          
          // Update flip counter first
          if (flipCounterSpan) {
              flipCount = parseInt(flipCounterSpan.textContent) + 1;
              flipCounterSpan.textContent = flipCount;
          }

          // Update button count
          button.textContent = parseInt(button.textContent) + 1;

          // Remove current card from array
          cards.splice(currentIndex, 1);

          // Reposition based on confidence
          switch(confidenceLevel) {
              case 'Again':
                  cards.splice(currentIndex + 1, 0, currentCard);
                  break;
              case 'Needs Work':
                  const middlePosition = Math.floor(cards.length / 2);
                  cards.splice(middlePosition, 0, currentCard);
                  break;
              case 'Good':
              case 'Confident':
                  cards.push(currentCard);
                  break;
          }

          // Only clear the card container instead of the entire main content
          cardContainer.innerHTML = '';
          
          // Re-add cards in new order
          cards.forEach((card, index) => {
              const newCard = card.cloneNode(true);
              newCard.classList.remove('active', 'flipped');
              if (index === 0) {
                  newCard.classList.add('active');
              }
              cardContainer.appendChild(newCard);
          });

          // Update cards array with new DOM elements
          cards = Array.from(document.querySelectorAll('.card'));
          currentIndex = 0;
      };
    });
  </script>

</body>

</html>
