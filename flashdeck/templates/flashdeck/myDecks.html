<!-- templates/flashdeck/myDecks.html -->
{% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon" href="{% static 'flashdeck/images/Logo.png' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'flashdeck/css/styles.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap"
        rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Decks | FlashDeck</title>
</head>

<body>
    <!-- NAVBAR -->
    <nav class="navbar fixed-top navbar-dark bg-black navbar-expand-lg rounded-bottom-2">
        <div class="container-fluid">
            <a href="/" class="navbar-brand">
                <img src="{% static 'flashdeck/images/Logo.png' %}" class="img-fluid" alt="." width="60" height="60">
                <p class="d-inline" id="flashdeckTitleNav">FLASHDECK</p>
            </a>
            <button class="navbar-toggler border" id="navbarToggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a href="{% url 'cardset_list' %}" class="nav-link active">My Decks</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'account' %}">Account</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- END NAVBAR -->

    <div class="row mt-5"></div> <!-- spacing -->

    <!-- HEADER -->
    <div class="container mt-5 pt-5">
        <div class="row mt-2">
            <div class="col text-white">
                <h1>My Decks</h1>
            </div>
        </div>
    </div>
    <!-- END HEADER -->

    <!-- Search / Filter -->
    <div class="container mt-2 pt-5">
        <div class="row mt-2">
            <div class="col-4 text-white d-flex"> 
                <!--<input type="text" class="form-control me-3" placeholder="Search">-->
                <button id="createDeckButton" data-bs-toggle="modal" data-bs-target="#cardModal">Create</button>
            </div>
           <!-- <div class="col"></div> spacing 
            <div class="col d-flex text-white justify-content-end align-items-center">
                <button id="filterButton">Filter</button>
            </div>-->
        </div>
    </div>

    <!-- Deck Grid -->
    {% block content %}
    <div class="container mt-5">
        <div class="row" id="cardGrid">
            {% for deck in sets %}
            <div class="col-md-4 mb-4">
                <div class="card" data-bs-toggle="modal" data-bs-target="#cardOptionsModal" data-deck-id="{{ deck.id }}">
                    <div class="card-body text-center">
                        <h5 class="card-title">{{ deck.name }}</h5>
                        <p class="card-text">{{ deck.description }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <!-- END Deck Grid -->

    <!-- Create Deck Modal -->
    <div class="modal fade" id="cardModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content p-3">
                <div class="modal-body">
                    <form method="POST" action="{% url 'add_cardset' %}">
                        {% csrf_token %}
                        <div class="row my-3">
                            <h2 class="text-white text-center">Name your Deck</h2>
                        </div>
                        <div class="row my-3">
                            <textarea name="name" class="deckNameInput" placeholder="Enter a name for your deck"
                                id="nameInput"></textarea>
                        </div>
                        <div class="row mt-5 mb-3">
                            <h2 class="text-white text-center">Deck Description</h2>
                        </div>
                        <div class="row my-3">
                            <textarea name="description" class="deckDescInput" placeholder="Enter a description"
                                id="descInput"></textarea>
                        </div>
                        <div class="row my-3 d-flex justify-content-center">
                            <button type="button" class="btn closeModalButton" data-bs-dismiss="modal">Cancel</button>
                        </div>
                        <div class="row my-3 d-flex justify-content-center">
                            <button type="submit" class="btn saveModalButton" id="saveDeckButton"
                                data-bs-dismiss="modal">Save Deck</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- End Create Deck Modal -->

    <!--card options modal-->
    <div class="modal fade" id="cardOptionsModal" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content p-3">
          <div class="modal-body">
            <div class="row my-3">
              <h2 class="text-white text-center">Options</h2>
            </div>
            <div class="row my-2">
              <div class="col-6 d-flex justify-content-center">
                <button class="btn editDeckButton" data-bs-toggle="modal">Edit Deck</button>
              </div>
              <div class="col-6 d-flex justify-content-center">
                <button class="btn addCardsButton" data-bs-toggle="modal"
                data-bs-target="#addCardsModal">Add Cards</button>
              </div>
            </div>
            <div class="row my-2">
              <div class="col-6 d-flex justify-content-center">
                <a href="#" class="btn studyButton">Study</a>
              </div>
              <div class="col-6 d-flex justify-content-center">
                <a href="#" class="btn quizButton">Quiz</a>
              </div>
            </div>
            <div class="row my-2">
              <div class="col-6 d-flex justify-content-center">
                <button class="btn deleteDeckButton" data-id="{{ deck.id }}" data-bs-target="#deleteDeckModal">Delete Deck</button>
              </div>
              <div class="col-6 d-flex justify-content-center">
                  <button type="button" class="btn closeModalButton" data-bs-dismiss="modal">Cancel</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
<!--card options modal end-->

<!--edit deck modal-->
    <div class="modal fade" id="editCardModal" tabindex="-1" role="dialog" data-bs-backdrop="static" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content p-3">
          <div class="modal-body">
            <form method="POST" action="" id="editDeckForm">
              {% csrf_token %}
              <div class="row my-3">
                <h2 class="text-white text-center">Edit Deck Details</h2>
              </div>
              <div class="row my-3">
                <label for="deckName" class="text-white">Deck Name</label>
                <textarea id="deckName" name="name" class="deckNameInput" required></textarea>
              </div>
              <div class="row mt-5 mb-3">
                <label for="deckDescription" class="text-white">Deck Description</label>
                <textarea id="deckDescription" name="description" class="deckDescInput" required></textarea>
              </div>
              <div class="row my-3 d-flex justify-content-center">
                <button type="button" class="btn closeModalButton" data-bs-dismiss="modal">Cancel</button>
              </div>
              <div class="row my-3 d-flex justify-content-center">
                <button type="submit" class="btn saveModalButton">Save Changes</button>
              </div>
            </form>             
          </div>
        </div>
      </div>
    </div>
    <!--edit deck modal END-->

    <!--add cards modal-->
    
    <div class="modal fade" id="addCardsModal" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
        <div class="modal-content p-3">
          <div class="modal-body">
            <form method="POST" enctype="multipart/form-data" id="addCardsModal">
              {% csrf_token %}
              <div class="row mt-1">
                <div class="col text-center cardHeader">
                  <h1>Front of Card</h1>
                </div>

                <div class="col text-center cardHeader">
                  <h1>Back of Card</h1>
                </div>
              </div>
              <div class="row text-center">
                <div class="col">
                  <textarea class="cardInput" name="question" required></textarea>
                </div>
                <div class="col">
                  <textarea class="cardInput" name="answer" required></textarea>
                </div>
              </div>

              <div class="container mt-5 mb-5 pb-5 d-flex justify-content-center">
                <button type="submit" class="addCardButton">Add / Save Card</button>
              </div>
            </form>

            <div class="row mt-4 pt-4">
              <div class="col d-flex justify-content-end">
                <button type="button" class="btn closeModalButton" data-bs-dismiss="modal">Cancel</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--add cards modal end-->

    <!-- delete deck confirmation modal -->
    <div class="modal fade" id="deleteDeckModal" tabindex="-1" role="dialog" aria-labelledby="deleteDeckModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content p-3">
          <div class="modal-body">
            <h5 class="text-white">Are you sure you want to delete this deck?</h5>
            <form method="POST" id="deleteDeckForm">
              {% csrf_token %}
              <button type="submit" class="btn deleteDeckButton">Delete</button>
              <button type="button" class="btn closeModalButton" data-bs-dismiss="modal">Cancel</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- end delete deck confirmation modal-->

    {% endblock %}
    <!--FOOTER-->
    <div class="container-fluid" id="footer">
      <div class="row"> <!--flashdeck-->
        <div class="col text-center text-white">
          <p id="footerHeader">FLASHDECK</p>
        </div>
      </div>

      <div class="row"> <!--lorem ipsum-->
        <div class="col text-center text-white"> 
          <div id="footerLoremIpsum">
            <p>Lorem Ipsum dolor sit amet consectetur adipisicing elit. Ratione veniam</p>
            <p>amet autem sunt. perspiciatis nemo.</p>
          </div>
        </div>

      <div class="row mb-1"> <!-- social media logos -->
        <div class="col d-flex justify-content-center" id="footerLogos">
          <a href="https://www.facebook.com/"><img class="img-fluid mx-1" src="{% static 'flashdeck/images/facebook-icon.png' %}" style="width: 25px; height: 25px" alt="Facebook"></a>
          <a href="https://www.instagram.com"><img class="img-fluid mx-1" src="{% static 'flashdeck/images/instagram-icon.png' %}" style="width: 25px; height: 25px" alt="Instagram"></a>
          <a href="https://twitter.com/"><img class="img-fluid mx-1" src="{% static 'flashdeck/images/x-icon.png' %}" style="width: 25px; height: 25px" alt="X"></a>
        </div>
      </div>

      <div class="row"> <!-- legal -->
        <div class="col d-flex text-white justify-content-center">
          <p id="footerLegal">© 2024 FlashDeck | All Rights Reserved</p>
        </div>
      </div>
    </div>
    <!--END-->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
          // Attach event listener to deck cards
          document.querySelectorAll('.card[data-bs-toggle="modal"]').forEach((card) => {
              card.addEventListener('click', () => {
                  const deckId = card.getAttribute('data-deck-id');
                  console.log(`Clicked Deck ID: ${deckId}`);

                  // Update delete button's data-id in the options modal
                  const deleteButton = document.querySelector('#cardOptionsModal .deleteDeckButton');
                  if (deleteButton) {
                      deleteButton.setAttribute('data-id', deckId);
                  }

                  // Update other buttons if needed (e.g., edit, study, quiz)
                  const editButton = document.querySelector('#cardOptionsModal .editDeckButton');
                  if (editButton) {
                      editButton.setAttribute('data-deck-id', deckId);
                  }

                  const studyButton = document.querySelector('#cardOptionsModal .studyButton');
                  studyButton.href = `/study/${deckId}`;

                  const quizButton = document.querySelector('#cardOptionsModal .quizButton');
                  quizButton.href = `/quiz/${deckId}`;

                  const addCardsButton = document.querySelector('#cardOptionsModal .addCardsButton');
                  if(addCardsButton){
                    addCardsButton.setAttribute('data-deck-id', deckId);
                  }
                 
              });
          });

          document.querySelectorAll('.addCardsButton').forEach((button) => {
            button.addEventListener('click', () => {
              const deckId = button.getAttribute('data-deck-id');
              console.log(`Adding Cards Deck ID: ${deckId}`);

              const addModalElement = document.getElementById('addCardsModal');

              const addModal = new bootstrap.Modal(addModalElement);
              addModal.show();

              const form = addModalElement.querySelector('form');
              form.setAttribute('action', `/set/${deckId}/add/`);
            });
          });
          
          document.querySelectorAll('.editDeckButton').forEach((button) => {
            button.addEventListener('click', () => {
                const deckId = button.getAttribute('data-deck-id');
                console.log(`Editing Deck ID: ${deckId}`);

                // Get the modal element directly
                const editModalElement = document.getElementById('editCardModal');

                // Open the Edit Deck Modal
                const editModal = new bootstrap.Modal(editModalElement);
                editModal.show();

                // Populate the modal with dynamic content
                const deckTitle = document.querySelector(`.card[data-deck-id="${deckId}"] .card-title`).textContent;
                const deckDescription = document.querySelector(`.card[data-deck-id="${deckId}"] .card-text`).textContent;

                // Fill in the modal's input fields using querySelector on the modal element
                editModalElement.querySelector('textarea[name="name"]').value = deckTitle;
                editModalElement.querySelector('textarea[name="description"]').value = deckDescription;

                // Set form action URL dynamically
                const form = editModalElement.querySelector('form');
                form.setAttribute('action', `/cardset/${deckId}/edit/`); // Adjust to your URL pattern
            });
        });


          // Attach event listener to delete buttons
          document.querySelectorAll('.deleteDeckButton').forEach((button) => {
              button.addEventListener('click', () => {
                  const deckId = button.getAttribute('data-id');

                  if (!deckId) {
                      console.error("No deckId found!");
                      return;
                  }

                  console.log(`Opening Confirmation Modal for Deck ID: ${deckId}`);

                  // Pass the deckId to the Delete Form
                  const deleteForm = document.querySelector('#deleteDeckForm');
                  deleteForm.action = `/cardset/${deckId}/delete/`;

                  // Show the Delete Modal
                  const deleteModal = new bootstrap.Modal(document.getElementById('deleteDeckModal'));
                  deleteModal.show();
              });
          });


          // Ensure the cancel button dismisses the modal
        document.querySelectorAll('[data-bs-dismiss="modal"]').forEach((button) => {
            button.addEventListener('click', () => {
                const modal = bootstrap.Modal.getInstance(document.getElementById('deleteDeckModal'));
                modal.hide(); // Manually hide the modal if needed
                const backdrop = document.querySelector('.modal-backdrop');
                if (backdrop) {
                    backdrop.remove(); // Manually remove the backdrop
                }
            });
        });

        document.querySelectorAll('[data-bs-dismiss="modal"]').forEach((button) => {
            button.addEventListener('click', () => {
                const modal = bootstrap.Modal.getInstance(document.getElementById('addCardsModal'));
                modal.hide(); // Manually hide the modal if needed
                const backdrop = document.querySelector('.modal-backdrop');
                if (backdrop) {
                    backdrop.remove(); // Manually remove the backdrop
                }
            });
        });


      });
      
    </script>

  </body>

</html>